wf.define("meetingTime",[],function(){return function(){var u=8,i=17,n=10,t=":",r='<li data-value="{0}" class="wf-select-option {2}">{1}<\/li>',f=function(){return{toTime:n=>{var i=n%60;return Math.floor(n/60)+t+(i<10?"0"+i:i)},toMinutes:n=>{var i=n.split(t);return parseInt(i[0])*60+parseInt(i[1])}}}();return{render:function(e,o){var a=[],c=new Date,v=c.getHours(),w=c.getMinutes(),y,p,l,s,h;if(v>=i)return r.format("","下班");for(o&&(l=o.split(t),y=parseInt(l[0]),p=parseInt(l[1])),s=c.format("yyyy-MM-dd")==e?o?y*60+Math.ceil(p/n)*n:v*60+Math.ceil(w/n)*n:u*60;s<=i*60;s=s+n)h=f.toTime(s),a.push(r.format(h,h,h==o?"wf-select-option-selected":""));return a.join("")}}}()});wf.define("meeting",[],function(){return(()=>{var n=(n,t,i)=>{$.post(n,t,n=>{$.isFunction(i)&&i(n)})};return{save:(t,i)=>{n("meeting/save",t,i)},remove:(t,i)=>{n("meeting/delete",{id:t},i)}}})()});wf.define("meetingCheck",[],function(){return function(){var n=function(n){return n.substring(0,1)>1&&(n="0"+n),n};return{check:function(t,i){return(t.startTime=n(t.startTime),t.endTime=n(t.endTime),i.startTime=n(i.startTime),i.endTime=n(i.endTime),t.endTime<=t.startTime)?!1:t.date==i.date&&t.tableRoom==i.tableRoom?t.startTime>=i.endTime||t.endTime<=i.startTime?!0:!1:!0}}}});wf.define("meetingCard",[],function(){var n=wf.require("meeting"),t=wf.require("meetingTime"),i=wf.require("meetingCheck");return function(r,u,f){var e=u.find(".meeting-save"),y=u.find(".meeting-delete"),p=u.find(".meeting-startTime"),w=u.find(".meeting-endTime"),l="meeting-saved",a="meeting-edit",s="meeting-editing",h=".meeting-list-wrapper",c="meeting-error",o=n=>u.find('[name="{0}"]'.format(n)),v=function(n){return n.substring(0,1)>1&&(n="0"+n),n},b=function(){var i=["tableRoom","startTime","endTime"],n={date:f},t=[];return e.parents(".meeting-card").siblings(".meeting-saved").each(function(){var u=[],r;for($(this).find(".wf-select-input").each(function(){var n=$(this);u.push(n.val())}),r=0;r<u.length;r++)n[i[r]]=u[r];t.push(n)}),t},k=function(){var t={},n={date:f},u,r;if(["id","title","userName","tableRoom","startTime","endTime"].forEach(n=>{t[n]=o(n)}),!t.title.val())return t.title.focus(),null;if(!t.userName.val())return t.userName.focus(),null;for(u in t)n[u]=t[u].val();var l=i(),s=b(),h=!0;for(s.length==0&&(n.startTime=v(n.startTime),n.endTime=v(n.endTime),n.endTime<=n.startTime&&(h=!1,e.parent().parent().addClass(c),setTimeout(function(){e.parent().parent().removeClass(c)},2e3))),r=0;r<s.length;r++)l.check(n,s[r])||(h=!1,e.parent().parent().addClass(c),setTimeout(function(){e.parent().parent().removeClass(c)},2e3));if(h)return n};return p.find(".time-option").html(t.render(f,o("startTime").val())),w.find(".time-option").html(t.render(f,o("endTime").val())),e.click(function(){var t=k();t&&n.save(t,n=>{n.success?(t.id||o("id").val(n.id),e.parent().parent().addClass(l),u.closest(h).removeClass(s)):$("#message-trigger").click()})}),y.click(function(){var t=o("id").val(),i=function(){u.closest(h).removeClass(s);u.remove()};t?n.remove(t,n=>{n.success&&i()}):i()}),u.hover(function(){$(this).hasClass(l)&&$(this).find("."+a).show()},function(){$(this).find("."+a).hide()}),u.find("."+a+" .wf-btn").click(function(){u.removeClass(l).closest(h).addClass(s);$(this).parent().hide()}),{addTo:function(n){n.append(u);u.closest(h).addClass(s)}}}});wf.require("page").render("meetingBorad",["UI.Select","UI.Modal"],function(){var n=this,t="meeting-temp",i=wf.require("meetingCard"),r=$("."+t).remove().removeClass(t),u;r.find("[data-rendered]").removeAttr("data-rendered");$(".meeting-add").click(function(){var t=$(this),u=r.clone(),f=t.prev().find(".meeting-date").html(),e=i(t,u,f);e.addTo(t.prev());n.refresh()});u=$(".meeting-board-wrapper").find(".meeting-card");$.each(u,function(){i("",$(this),$(this).parent().find(".meeting-date").html())});n.refresh()});